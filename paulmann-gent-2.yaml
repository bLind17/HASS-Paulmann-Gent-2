blueprint:
  domain: automation
  name: "Paulmann Gent 2 (501.40) - Zigbee2MQTT (IceBeach style)"
  description: >
    Use the Paulmann Gent 2 remote (501.40) via Zigbee2MQTT with full
    per-button, per-scene customization, closely mirroring the IceBeach7 ZHA blueprint.

  input:
    mqtt_topic:
      name: MQTT topic of the remote
      description: 'Example: zigbee2mqtt/Paulmann Remote'
      selector:
        text:

    # Definition of the actions
    s1_section:
      name: "Scene 1 (Group 1)"
      icon: mdi:numeric-1-box
      collapsed: true
      input:
        sc1_power_off:
          name: "â» Power - Off"
          selector:
            action: {}
          default: []

        sc1_power_on:
          name: "â» Power - On"
          selector:
            action: {}
          default: []

        sc1_brightness_lower:
          name: "â” Lower brightness"
          selector:
            action: {}
          default: []

        sc1_brightness_higher:
          name: "âœš Higher brightness"
          selector:
            action: {}
          default: []

        sc1_fire:
          name: "ðŸ”¥ Fire"
          selector:
            action: {}
          default: []

        sc1_skip:
          name: "â­ï¸ Skip"
          selector:
            action: {}
          default: []

        sc1_snow:
          name: "â„ï¸ Snow"
          selector:
            action: {}
          default: []

        sc1_s1:
          name: "ðŸ”˜ S1"
          selector:
            action: {}
          default: []

        sc1_s2:
          name: "ðŸ”˜ S2"
          selector:
            action: {}
          default: []

        sc1_s3:
          name: "ðŸ”˜ S3"
          selector:
            action: {}
          default: []

        sc1_s4:
          name: "ðŸ”˜ S4"
          selector:
            action: {}
          default: []

        sc1_s5:
          name: "ðŸ”˜ S5"
          selector:
            action: {}
          default: []

        sc1_s6:
          name: "ðŸ”˜ S6"
          selector:
            action: {}
          default: []

        sc1_s7:
          name: "ðŸ”˜ S7"
          selector:
            action: {}
          default: []

        sc1_repeat:
          name: "ðŸ”„ Repeat"
          selector:
            action: {}
          default: []

        sc1_color_wheel_button:
          name: "â—‘ Color wheel - Button (center)"
          selector:
            action: {}
          default: []

        sc1_color_wheel_light:
          name: "ðŸ’¡ Color wheel - Light"
          selector:
            entity:
              filter:
                - domain: light
          default: {}

        sc1_color_wheel_saturation:
          name: "ðŸŽšï¸ Color wheel - Saturation"
          selector:
            number:
              min: 0
              max: 100
          default: 100

        sc1_color_wheel_on_if_off:
          name: "ðŸ§  Color wheel - Turn on, if off"
          selector:
            boolean: {}
          default: false

    s2_section:
      name: "Scene 2 (Group 2)"
      icon: mdi:numeric-2-box
      collapsed: true
      input:
        sc2_power_off:
          name: "â» Power - Off"
          selector:
            action: {}
          default: []

        sc2_power_on:
          name: "â» Power - On"
          selector:
            action: {}
          default: []

        sc2_brightness_lower:
          name: "â” Lower brightness"
          selector:
            action: {}
          default: []

        sc2_brightness_higher:
          name: "âœš Higher brightness"
          selector:
            action: {}
          default: []

        sc2_fire:
          name: "ðŸ”¥ Fire"
          selector:
            action: {}
          default: []

        sc2_skip:
          name: "â­ï¸ Skip"
          selector:
            action: {}
          default: []

        sc2_snow:
          name: "â„ï¸ Snow"
          selector:
            action: {}
          default: []

        sc2_s1:
          name: "ðŸ”˜ S1"
          selector:
            action: {}
          default: []

        sc2_s2:
          name: "ðŸ”˜ S2"
          selector:
            action: {}
          default: []

        sc2_s3:
          name: "ðŸ”˜ S3"
          selector:
            action: {}
          default: []

        sc2_s4:
          name: "ðŸ”˜ S4"
          selector:
            action: {}
          default: []

        sc2_s5:
          name: "ðŸ”˜ S5"
          selector:
            action: {}
          default: []

        sc2_s6:
          name: "ðŸ”˜ S6"
          selector:
            action: {}
          default: []

        sc2_s7:
          name: "ðŸ”˜ S7"
          selector:
            action: {}
          default: []

        sc2_repeat:
          name: "ðŸ”„ Repeat"
          selector:
            action: {}
          default: []

        sc2_color_wheel_button:
          name: "â—‘ Color wheel - Button (center)"
          selector:
            action: {}
          default: []

        sc2_color_wheel_light:
          name: "ðŸ’¡ Color wheel - Light"
          selector:
            entity:
              filter:
                - domain: light
          default: {}

        sc2_color_wheel_saturation:
          name: "ðŸŽšï¸ Color wheel - Saturation"
          selector:
            number:
              min: 0
              max: 100
          default: 100

        sc2_color_wheel_on_if_off:
          name: "ðŸ§  Color wheel - Turn on, if off"
          selector:
            boolean: {}
          default: false

    s3_section:
      name: "Scene 3 (Group 3)"
      icon: mdi:numeric-3-box
      collapsed: true
      input:
        sc3_power_off:
          name: "â» Power - Off"
          selector:
            action: {}
          default: []

        sc3_power_on:
          name: "â» Power - On"
          selector:
            action: {}
          default: []

        sc3_brightness_lower:
          name: "â” Lower brightness"
          selector:
            action: {}
          default: []

        sc3_brightness_higher:
          name: "âœš Higher brightness"
          selector:
            action: {}
          default: []

        sc3_fire:
          name: "ðŸ”¥ Fire"
          selector:
            action: {}
          default: []

        sc3_skip:
          name: "â­ï¸ Skip"
          selector:
            action: {}
          default: []

        sc3_snow:
          name: "â„ï¸ Snow"
          selector:
            action: {}
          default: []

        sc3_s1:
          name: "ðŸ”˜ S1"
          selector:
            action: {}
          default: []

        sc3_s2:
          name: "ðŸ”˜ S2"
          selector:
            action: {}
          default: []

        sc3_s3:
          name: "ðŸ”˜ S3"
          selector:
            action: {}
          default: []

        sc3_s4:
          name: "ðŸ”˜ S4"
          selector:
            action: {}
          default: []

        sc3_s5:
          name: "ðŸ”˜ S5"
          selector:
            action: {}
          default: []

        sc3_s6:
          name: "ðŸ”˜ S6"
          selector:
            action: {}
          default: []

        sc3_s7:
          name: "ðŸ”˜ S7"
          selector:
            action: {}
          default: []

        sc3_repeat:
          name: "ðŸ”„ Repeat"
          selector:
            action: {}
          default: []

        sc3_color_wheel_button:
          name: "â—‘ Color wheel - Button (center)"
          selector:
            action: {}
          default: []

        sc3_color_wheel_light:
          name: "ðŸ’¡ Color wheel - Light"
          selector:
            entity:
              filter:
                - domain: light
          default: {}

        sc3_color_wheel_saturation:
          name: "ðŸŽšï¸ Color wheel - Saturation"
          selector:
            number:
              min: 0
              max: 100
          default: 100

        sc3_color_wheel_on_if_off:
          name: "ðŸ§  Color wheel - Turn on, if off"
          selector:
            boolean: {}
          default: false

    s4_section:
      name: "Scene 4 (Group 4)"
      icon: mdi:numeric-4-box
      collapsed: true
      input:
        sc4_power_off:
          name: "â» Power - Off"
          selector:
            action: {}
          default: []

        sc4_power_on:
          name: "â» Power - On"
          selector:
            action: {}
          default: []

        sc4_brightness_lower:
          name: "â” Lower brightness"
          selector:
            action: {}
          default: []

        sc4_brightness_higher:
          name: "âœš Higher brightness"
          selector:
            action: {}
          default: []

        sc4_fire:
          name: "ðŸ”¥ Fire"
          selector:
            action: {}
          default: []

        sc4_skip:
          name: "â­ï¸ Skip"
          selector:
            action: {}
          default: []

        sc4_snow:
          name: "â„ï¸ Snow"
          selector:
            action: {}
          default: []

        sc4_s1:
          name: "ðŸ”˜ S1"
          selector:
            action: {}
          default: []

        sc4_s2:
          name: "ðŸ”˜ S2"
          selector:
            action: {}
          default: []

        sc4_s3:
          name: "ðŸ”˜ S3"
          selector:
            action: {}
          default: []

        sc4_s4:
          name: "ðŸ”˜ S4"
          selector:
            action: {}
          default: []

        sc4_s5:
          name: "ðŸ”˜ S5"
          selector:
            action: {}
          default: []

        sc4_s6:
          name: "ðŸ”˜ S6"
          selector:
            action: {}
          default: []

        sc4_s7:
          name: "ðŸ”˜ S7"
          selector:
            action: {}
          default: []

        sc4_repeat:
          name: "ðŸ”„ Repeat"
          selector:
            action: {}
          default: []

        sc4_color_wheel_button:
          name: "â—‘ Color wheel - Button (center)"
          selector:
            action: {}
          default: []

        sc4_color_wheel_light:
          name: "ðŸ’¡ Color wheel - Light"
          selector:
            entity:
              filter:
                - domain: light
          default: {}

        sc4_color_wheel_saturation:
          name: "ðŸŽšï¸ Color wheel - Saturation"
          selector:
            number:
              min: 0
              max: 100
          default: 100

        sc4_color_wheel_on_if_off:
          name: "ðŸ§  Color wheel - Turn on, if off"
          selector:
            boolean: {}
          default: false

# When user chooses multiple scenes, it could lead to multiple actions at once.
mode: parallel

trigger:
  - platform: mqtt
    topic: !input mqtt_topic

action:
  - choose:
      - conditions:
          - condition: template
            value_template: "{{ trigger.payload_json.action is defined }}"
        sequence:
          - variables:
              action_str: "{{ trigger.payload_json.action }}"
              command_name: "{{ action_str[:-2] }}"
              selected_group: "{{ action_str[-1:] | int(0) }}"
          - choose:

              # ---------- Scene 1 (group 1) ----------

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 1 and command_name == 'off' }}"
                sequence: !input sc1_power_off

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 1 and command_name == 'on' }}"
                sequence: !input sc1_power_on

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 1 and command_name == 'brightness_step_down' }}"
                sequence: !input sc1_brightness_lower

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 1 and command_name == 'brightness_step_up' }}"
                sequence: !input sc1_brightness_higher

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 1 and command_name == 'color_temperature_step_up' }}"
                sequence: !input sc1_fire

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 1 and command_name == 'color_temperature_move' }}"
                sequence: !input sc1_skip

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 1 and command_name == 'color_temperature_step_down' }}"
                sequence: !input sc1_snow

              # Scenes S1-S7 via recall_n_1
              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 1 and command_name[:6] == 'recall' and command_name[7:8] | int == 1 }}
                sequence: !input sc1_s1

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 1 and command_name[:6] == 'recall' and command_name[7:8] | int == 2 }}
                sequence: !input sc1_s2

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 1 and command_name[:6] == 'recall' and command_name[7:8] | int == 3 }}
                sequence: !input sc1_s3

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 1 and command_name[:6] == 'recall' and command_name[7:8] | int == 4 }}
                sequence: !input sc1_s4

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 1 and command_name[:6] == 'recall' and command_name[7:8] | int == 5 }}
                sequence: !input sc1_s5

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 1 and command_name[:6] == 'recall' and command_name[7:8] | int == 6 }}
                sequence: !input sc1_s6

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 1 and command_name[:6] == 'recall' and command_name[7:8] | int == 7 }}
                sequence: !input sc1_s7

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 1 and command_name == 'hue_move' }}"
                sequence: !input sc1_repeat

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 1 and command_name == 'move_to_saturation' }}"
                sequence: !input sc1_color_wheel_button

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 1 and command_name == 'move_to_hue_and_saturation' }}"
                sequence:
                  - variables:
                      light: !input sc1_color_wheel_light
                      do_it_anyway: !input sc1_color_wheel_on_if_off
                  - if:
                      - condition: template
                        value_template: "{{ do_it_anyway or is_state(light, 'on') }}"
                    then:
                      - action: light.turn_on
                        target:
                          entity_id: !input sc1_color_wheel_light
                        data:
                          hs_color:
                            - "{{ trigger.payload_json.action_hue / 255 * 360 }}"
                            - !input sc1_color_wheel_saturation

              # ---------- Scene 2 (group 2) ----------

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 2 and command_name == 'off' }}"
                sequence: !input sc2_power_off

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 2 and command_name == 'on' }}"
                sequence: !input sc2_power_on

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 2 and command_name == 'brightness_step_down' }}"
                sequence: !input sc2_brightness_lower

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 2 and command_name == 'brightness_step_up' }}"
                sequence: !input sc2_brightness_higher

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 2 and command_name == 'color_temperature_step_up' }}"
                sequence: !input sc2_fire

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 2 and command_name == 'color_temperature_move' }}"
                sequence: !input sc2_skip

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 2 and command_name == 'color_temperature_step_down' }}"
                sequence: !input sc2_snow

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 2 and command_name[:6] == 'recall' and command_name[7:8] | int == 1 }}
                sequence: !input sc2_s1

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 2 and command_name[:6] == 'recall' and command_name[7:8] | int == 2 }}
                sequence: !input sc2_s2

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 2 and command_name[:6] == 'recall' and command_name[7:8] | int == 3 }}
                sequence: !input sc2_s3

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 2 and command_name[:6] == 'recall' and command_name[7:8] | int == 4 }}
                sequence: !input sc2_s4

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 2 and command_name[:6] == 'recall' and command_name[7:8] | int == 5 }}
                sequence: !input sc2_s5

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 2 and command_name[:6] == 'recall' and command_name[7:8] | int == 6 }}
                sequence: !input sc2_s6

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 2 and command_name[:6] == 'recall' and command_name[7:8] | int == 7 }}
                sequence: !input sc2_s7

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 2 and command_name == 'hue_move' }}"
                sequence: !input sc2_repeat

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 2 and command_name == 'move_to_saturation' }}"
                sequence: !input sc2_color_wheel_button

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 2 and command_name == 'move_to_hue_and_saturation' }}"
                sequence:
                  - variables:
                      light: !input sc2_color_wheel_light
                      do_it_anyway: !input sc2_color_wheel_on_if_off
                  - if:
                      - condition: template
                        value_template: "{{ do_it_anyway or is_state(light, 'on') }}"
                    then:
                      - action: light.turn_on
                        target:
                          entity_id: !input sc2_color_wheel_light
                        data:
                          hs_color:
                            - "{{ trigger.payload_json.action_hue / 255 * 360 }}"
                            - !input sc2_color_wheel_saturation

              # ---------- Scene 3 (group 3) ----------

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 3 and command_name == 'off' }}"
                sequence: !input sc3_power_off

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 3 and command_name == 'on' }}"
                sequence: !input sc3_power_on

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 3 and command_name == 'brightness_step_down' }}"
                sequence: !input sc3_brightness_lower

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 3 and command_name == 'brightness_step_up' }}"
                sequence: !input sc3_brightness_higher

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 3 and command_name == 'color_temperature_step_up' }}"
                sequence: !input sc3_fire

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 3 and command_name == 'color_temperature_move' }}"
                sequence: !input sc3_skip

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 3 and command_name == 'color_temperature_step_down' }}"
                sequence: !input sc3_snow

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 3 and command_name[:6] == 'recall' and command_name[7:8] | int == 1 }}
                sequence: !input sc3_s1

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 3 and command_name[:6] == 'recall' and command_name[7:8] | int == 2 }}
                sequence: !input sc3_s2

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 3 and command_name[:6] == 'recall' and command_name[7:8] | int == 3 }}
                sequence: !input sc3_s3

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 3 and command_name[:6] == 'recall' and command_name[7:8] | int == 4 }}
                sequence: !input sc3_s4

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 3 and command_name[:6] == 'recall' and command_name[7:8] | int == 5 }}
                sequence: !input sc3_s5

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 3 and command_name[:6] == 'recall' and command_name[7:8] | int == 6 }}
                sequence: !input sc3_s6

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 3 and command_name[:6] == 'recall' and command_name[7:8] | int == 7 }}
                sequence: !input sc3_s7

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 3 and command_name == 'hue_move' }}"
                sequence: !input sc3_repeat

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 3 and command_name == 'move_to_saturation' }}"
                sequence: !input sc3_color_wheel_button

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 3 and command_name == 'move_to_hue_and_saturation' }}"
                sequence:
                  - variables:
                      light: !input sc3_color_wheel_light
                      do_it_anyway: !input sc3_color_wheel_on_if_off
                  - if:
                      - condition: template
                        value_template: "{{ do_it_anyway or is_state(light, 'on') }}"
                    then:
                      - action: light.turn_on
                        target:
                          entity_id: !input sc3_color_wheel_light
                        data:
                          hs_color:
                            - "{{ trigger.payload_json.action_hue / 255 * 360 }}"
                            - !input sc3_color_wheel_saturation

              # ---------- Scene 4 (group 4) ----------

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 4 and command_name == 'off' }}"
                sequence: !input sc4_power_off

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 4 and command_name == 'on' }}"
                sequence: !input sc4_power_on

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 4 and command_name == 'brightness_step_down' }}"
                sequence: !input sc4_brightness_lower

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 4 and command_name == 'brightness_step_up' }}"
                sequence: !input sc4_brightness_higher

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 4 and command_name == 'color_temperature_step_up' }}"
                sequence: !input sc4_fire

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 4 and command_name == 'color_temperature_move' }}"
                sequence: !input sc4_skip

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 4 and command_name == 'color_temperature_step_down' }}"
                sequence: !input sc4_snow

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 4 and command_name[:6] == 'recall' and command_name[7:8] | int == 1 }}
                sequence: !input sc4_s1

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 4 and command_name[:6] == 'recall' and command_name[7:8] | int == 2 }}
                sequence: !input sc4_s2

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 4 and command_name[:6] == 'recall' and command_name[7:8] | int == 3 }}
                sequence: !input sc4_s3

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 4 and command_name[:6] == 'recall' and command_name[7:8] | int == 4 }}
                sequence: !input sc4_s4

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 4 and command_name[:6] == 'recall' and command_name[7:8] | int == 5 }}
                sequence: !input sc4_s5

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 4 and command_name[:6] == 'recall' and command_name[7:8] | int == 6 }}
                sequence: !input sc4_s6

              - conditions:
                  - condition: template
                    value_template: >
                      {{ selected_group == 4 and command_name[:6] == 'recall' and command_name[7:8] | int == 7 }}
                sequence: !input sc4_s7

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 4 and command_name == 'hue_move' }}"
                sequence: !input sc4_repeat

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 4 and command_name == 'move_to_saturation' }}"
                sequence: !input sc4_color_wheel_button

              - conditions:
                  - condition: template
                    value_template: "{{ selected_group == 4 and command_name == 'move_to_hue_and_saturation' }}"
                sequence:
                  - variables:
                      light: !input sc4_color_wheel_light
                      do_it_anyway: !input sc4_color_wheel_on_if_off
                  - if:
                      - condition: template
                        value_template: "{{ do_it_anyway or is_state(light, 'on') }}"
                    then:
                      - action: light.turn_on
                        target:
                          entity_id: !input sc4_color_wheel_light
                        data:
                          hs_color:
                            - "{{ trigger.payload_json.action_hue / 255 * 360 }}"
                            - !input sc4_color_wheel_saturation

    default: []
